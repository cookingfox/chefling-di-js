!function(a,b){"function"==typeof define&&define.amd?define([],function(){return a.Container=b()}):"object"==typeof exports?module.exports=b():a.Container=b()}(this,function(){"use strict";function HashMap(){function a(a){var c,d;for(c=0,d=b.length;d>c;++c)if(b[c]===a)return c}var b=[],c=[];this.get=function(b){return c[a(b)]},this.getKeysForValue=function(a){var d,e,f=[];for(d=0,e=c.length;e>d;++d)c[d]===a&&f.push(b[d]);return f},this.getValues=function(){return c},this.has=function(b){return!!c[a(b)]},this.remove=function(d){var e=a(d);delete b[e],delete c[e]},this.set=function(d,e){var f=a(d);void 0!==f?(b[f]=d,c[f]=e):(b.push(d),c.push(e))}}function Container(){function b(){l=new Array,m=new HashMap,n=new HashMap,m.set(Container,r)}function c(b,c){if(r.has(b))throw new a("A mapping for `type` already exists");n.set(b,c)}function d(a){if(0===a.length)return new a;var b,c,d,e,f,h=[null],i=a.toString().match(o)[1].replace(p,"").replace(q,"").split(",");for(c=0,e=i.length;e>c;++c)f=g(i[c]),d=r.get(f),h.push(d);return new(b=a.bind.apply(a,h))}function e(b,c){var d=c(r);if(!d)throw new a("Factory returned an empty value");if(!(d instanceof b))throw new a("Factory returned an unexpected value");return d}function f(a){a&&a.onDestroy&&a.onDestroy()}function g(b){if(h(b))return b;if(h(window[b]))return window[b];throw new a("Value '"+b+"' ("+typeof b+") is not a function")}function h(a){return a&&"function"==typeof a}function i(a,b){return a&&b&&b.prototype instanceof a}function j(a,b){return b===a||i(a,b)||b instanceof a}function k(b){var c=null,d=typeof b;if(b?h(b)?b===Function?c="the base Function type":j(Error,b)?c="an Error type":j(Container,b)&&(c="a Container type"):c="not a function":c="empty",c){var e=b;throw b&&(e=Array.isArray(b)?"Array":b.name?b.name:d.charAt(0).toUpperCase()+d.slice(1)),new a("Type ["+e+"] is invalid, because it is "+c)}}var l,m,n,o=/^function[^\(]*\(([^\)]*)\)/m,p=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,q=/\s/gm,r=this;b(),this.create=function(b){k(b);var c,f=n.get(b);if(f?f instanceof b?c=f:h(f)&&(c=i(b,f)?r.create(f):e(b,f)):c=d(b),!c)throw new a("Could not create an instance for type "+b.name);return h(c.onCreate)&&c.onCreate(),c},this.get=function(b){var c=m.get(b);if(c)return c;k(b);var d=n.get(b);if(i(b,d))return r.get(d);if(l.indexOf(b)>=0)throw new a("Circular dependency detected: "+b.name);l.push(b);try{c=r.create(b)}finally{l.splice(l.indexOf(b),1)}return m.set(b,c),c},this.has=function(a){return m.has(a)||n.has(a)},this.mapFactory=function(b,d){if(k(b),!h(d))throw new a("Factory is not a function");c(b,d)},this.mapInstance=function(b,d){if(k(b),!d||"object"!=typeof d)throw new a("`instance` is not an object");if(!(d instanceof b))throw new a("Value is not an instance of `type`");c(b,d)},this.mapType=function(b,d){if(k(b),!h(d))throw new a("`subType` is not a function");if(!i(b,d))throw new a("`subType` does not extend `type`");c(b,d)},this.remove=function(b){if(k(b),b===Container)throw new a("Container instance can not be removed");f(m.get(b)),m.remove(b),n.remove(b);for(var c=n.getKeysForValue(b),d=0,e=c.length;e>d;++d)r.remove(c[d])},this.reset=function(){for(var a=m.getValues(),c=0,d=a.length;d>c;++c)f(a[c]);l=m=n=null,b()}}function a(b){this.message=b,Error.captureStackTrace?Error.captureStackTrace(this,a):this.stack=(new Error).stack||""}return Container.getDefault=function(){return Container.prototype._defaultInstance||(Container.prototype._defaultInstance=new Container),Container.prototype._defaultInstance},a.prototype=Object.create(Error.prototype),a.prototype.name="ContainerError",Container});